name: CI Pull Request
on:
  pull_request:

jobs:
  changes:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: read
    outputs:
      algopy: ${{ steps.filter.outputs.algopy }}
      algots: ${{ steps.filter.outputs.algots }}
      pyteal: ${{ steps.filter.outputs.pyteal }}
      ts: ${{ steps.filter.outputs.ts }}
    steps:
      - uses: dorny/paths-filter@v3
        id: filter
        with:
          predicate-quantifier: 'every'
          filters: |
            algopy:
              - '!projects/lib-pcg-algots/**'
              - '!projects/lib-pcg-pyteal/**'
              - '!projects/lib-pcg-ts/**'
              - '!projects/unified-tests/smart_contracts/artifacts/lib_pcg*_exposer_algo_ts.py'
              - '!projects/unified-tests/smart_contracts/artifacts/lib_pcg*_exposer_pyteal.py'
              - '!projects/unified-tests/smart_contracts/artifacts/lib_pcg*_exposer_ts.py'
            algots:
              - '!projects/lib-pcg-algopy/**'
              - '!projects/lib-pcg-pyteal/**'
              - '!projects/lib-pcg-ts/**'
              - '!projects/unified-tests/smart_contracts/artifacts/lib_pcg*_exposer_algo_py.py'
              - '!projects/unified-tests/smart_contracts/artifacts/lib_pcg*_exposer_pyteal.py'
              - '!projects/unified-tests/smart_contracts/artifacts/lib_pcg*_exposer_ts.py'
            pyteal:
              - '!projects/lib-pcg-algopy/**'
              - '!projects/lib-pcg-algots/**'
              - '!projects/lib-pcg-ts/**'
              - '!projects/unified-tests/smart_contracts/artifacts/lib_pcg*_exposer_algo_py.py'
              - '!projects/unified-tests/smart_contracts/artifacts/lib_pcg*_exposer_algo_ts.py'
              - '!projects/unified-tests/smart_contracts/artifacts/lib_pcg*_exposer_ts.py'
            ts:
              - '!projects/lib-pcg-algopy/**'
              - '!projects/lib-pcg-algots/**'
              - '!projects/lib-pcg-pyteal/**'
              - '!projects/unified-tests/smart_contracts/artifacts/lib_pcg*_exposer_algo_py.py'
              - '!projects/unified-tests/smart_contracts/artifacts/lib_pcg*_exposer_algo_ts.py'
              - '!projects/unified-tests/smart_contracts/artifacts/lib_pcg*_exposer_pyteal.py'

  lib-pcg-algopy-ci-validation:
    needs: changes
    uses: ./.github/workflows/validate-algopy.yml
    with:
      skip: ${{ needs.changes.outputs.algopy == 'false' }}

  lib-pcg-algots-ci-validation:
    needs: changes
    uses: ./.github/workflows/validate-algots.yml
    with:
      skip: ${{ needs.changes.outputs.algots == 'false' }}

  lib-pcg-pyteal-ci-validation:
    needs: changes
    uses: ./.github/workflows/validate-pyteal.yml
    with:
      skip: ${{ needs.changes.outputs.pyteal == 'false' }}

  lib-pcg-ts-ci-validation:
    needs: changes
    uses: ./.github/workflows/validate-ts.yml
    with:
      skip: ${{ needs.changes.outputs.ts == 'false' }}
